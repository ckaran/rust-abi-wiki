<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>What is an ABI - Rust ABI Wiki</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro/intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../intro/what_is_an_ABI.html" class="active"><strong aria-hidden="true">1.1.</strong> What is an ABI</a></li><li class="chapter-item expanded "><a href="../intro/history.html"><strong aria-hidden="true">1.2.</strong> A Short History</a></li><li class="chapter-item expanded "><a href="../intro/ip_summary.html"><strong aria-hidden="true">1.3.</strong> Initial Proposal Summary</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../intro/initial_proposal.html"><strong aria-hidden="true">1.3.1.</strong> Initial Proposal</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../discussion/discussion.html"><strong aria-hidden="true">2.</strong> Summary of the Discussion</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../discussion/repr_c.html"><strong aria-hidden="true">2.1.</strong> repr(C) as the Lowest Common Denominator</a></li><li class="chapter-item expanded "><a href="../discussion/terms.html"><strong aria-hidden="true">2.2.</strong> A Clarification of Terms</a></li><li class="chapter-item expanded "><a href="../discussion/generics.html"><strong aria-hidden="true">2.3.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../discussion/swift_abi.html"><strong aria-hidden="true">2.4.</strong> The Swift ABI?</a></li><li class="chapter-item expanded "><a href="../discussion/plugin_architecture.html"><strong aria-hidden="true">2.5.</strong> A Plugin-Style Architecture</a></li><li class="chapter-item expanded "><a href="../discussion/layout.html"><strong aria-hidden="true">2.6.</strong> Laying out Memory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../discussion/memory_ffi.html"><strong aria-hidden="true">2.6.1.</strong> Memory Management Across FFI</a></li></ol></li><li class="chapter-item expanded "><a href="../discussion/calling.html"><strong aria-hidden="true">2.7.</strong> Calling Conventions</a></li><li class="chapter-item expanded "><a href="../discussion/selection.html"><strong aria-hidden="true">2.8.</strong> ABI Selection</a></li><li class="chapter-item expanded "><a href="../discussion/one_ring.html"><strong aria-hidden="true">2.9.</strong> OneRing and ABI Boundaries</a></li><li class="chapter-item expanded "><a href="../discussion/niches.html"><strong aria-hidden="true">2.10.</strong> Niches</a></li><li class="chapter-item expanded "><a href="../discussion/glue.html"><strong aria-hidden="true">2.11.</strong> API/FFI, or, Code as Glue</a></li><li class="chapter-item expanded "><a href="../discussion/final_picture.html"><strong aria-hidden="true">2.12.</strong> A Final Picture</a></li></ol></li><li class="chapter-item expanded "><a href="../rust_compiler/rust_compiler.html"><strong aria-hidden="true">3.</strong> Rust's Compiler Infrastructure</a></li><li class="chapter-item expanded "><a href="../towards_rfc/towards_rfc.html"><strong aria-hidden="true">4.</strong> Towards an RFC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../towards_rfc/mvs.html"><strong aria-hidden="true">4.1.</strong> A Minimum Viable Subset</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Rust ABI Wiki</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#what-even-is-an-abi" id="what-even-is-an-abi">What Even Is An ABI?</a></h1>
<p>ABIs, FFIs, ABI APIs, what's the difference?
This document stands to serve as a FAQ as to what an ABI is, why they're important, and so on.</p>
<p>If you think of a question, add it. If you feel an answer is incomplete or lacking, raise an issue - or even better - a PR.</p>
<h2><a class="header" href="#so-what-is-an-abi-anyway" id="so-what-is-an-abi-anyway">So, what is an ABI anyway?</a></h2>
<p>An ABI, or Application Binary Interface, is the public-facing API of an executable that determines how other programs can call into it.</p>
<p>Wikipedia explains this much more succinctly:</p>
<blockquote>
<p>In computer software, an application binary interface (ABI) is an interface between two binary program modules; often, one of these modules is a library or operating system facility, and the other is a program that is being run by a user.</p>
<p>— Wikipedia</p>
</blockquote>
<p>ABIs describe two main facilities:</p>
<ul>
<li>How data is laid out in memory</li>
<li>How functions are called.</li>
</ul>
<p>The C ABI is the oldest ABI, dating back to C. The C ABI can be used from Rust through the use of <code>extern &quot;C&quot;</code>. The C ABI, however, is fairly lacking, as it only provides basic datatypes and is rather inflexible.</p>
<p>However, it's important to note that 'ABI' in of itself is a bit of an overloaded term:</p>
<blockquote>
<p>More concretely: there are broadly two clusters of meanings for &quot;stable ABI&quot;, the first referring to how language concepts are mapped machine code (e.g. data structure layout, calling conventions) and the latter to the ability to change (upgrade) a software component without rebuilding all the software that interacts with this component. The second is ultimately the responsibility of programmers (e.g. deleting a function from a library breaks both source compatibility and ABI compatibility), but since it's required for many of the benefits ascribed to &quot;stable ABI&quot; and requires compiler support too, anyone pondering this subject should either explicitly acknowledge that aspect (and everything that it enables) as out of scope, or think about what it entails -- which goes far beyond &quot;freezing&quot; data structure layouts, calling conventions, etc.</p>
<p>— <code>@hanna-kruppe</code>, IRLO</p>
</blockquote>
<h2><a class="header" href="#what-does-it-mean-for-an-abi-to-be-stable" id="what-does-it-mean-for-an-abi-to-be-stable">What does it mean for an ABI to be stable?</a></h2>
<p>A stable ABI means that a compiler will consistently produce the same ABI for an executable across versions.</p>
<p>Right now, this invariant is not present in the Rust Compiler, as the compiler may perform certain memory-layout optimizations (such as zero-sizing), different across versions.</p>
<h2><a class="header" href="#why-is-a-stable-abi-a-good-thing" id="why-is-a-stable-abi-a-good-thing">Why is a stable ABI a good thing?</a></h2>
<p>To quote from the initial proposal:</p>
<blockquote>
<p>There are many benefits a standardized ABI would bring to Rust. A stable ABI enables dynamic linking between Rust crates, which would allow for Rust programs to support dynamically loaded plugins (a feature common in C/C++). Dynamic linking would result in shorter compile-times and lower disk-space use for projects, as multiple projects could link to the same dylib. For example, imagine having multiple CLIs all link to the same core library crate.</p>
</blockquote>
<blockquote>
<p>TODO: more recent examples.</p>
</blockquote>
<h2><a class="header" href="#what-would-a-stable-modular-abi-look-like-for-rust" id="what-would-a-stable-modular-abi-look-like-for-rust">What would a stable modular ABI look like for Rust?</a></h2>
<ul>
<li><strong>Fully specified</strong> - There should be no ambiguous cases, either in how to map Rust to the ABI, or how the ABI maps back to Rust objects.</li>
<li><strong>Versioned</strong> - There should be a mechanism to determine which version of the ABI a chunk of code is using by querying the code itself.  The version should follow <a href="https://semver.org/">semver</a> conventions, and should be both machine and human parseable, so that linkers and loaders can decide if two pieces of code are compatible (from an ABI standpoint).  Under some circumstances, it may be possible for a linker or loader to generate code to bind chunks of code together that have different ABI versions.</li>
<li><strong>Designed for introspection</strong> - There are tools for different operating systems to analyze blobs of code to determine what they do.  For Linux, there are <a href="https://linux.die.net/man/1/nm">nm</a>, <a href="https://linux.die.net/man/1/objdump">objdump</a>, and a number of other utilities.  Unfortunately, the tools are limited by the knowledge encoded in the executable formats; in most cases you can't read the docs for a library by reading the library itself.  A useful addition would be the ability to store the documentation for a library in one of the segments of the library, with tools that are able to find and display that information.</li>
</ul>
<h2><a class="header" href="#additional-useful-traits" id="additional-useful-traits">Additional useful traits</a></h2>
<p>While the ABI we're developing is primarily for the Rust language, it need not be solely for the rust language.  Here are some additional traits that the ABI could have that might be useful.</p>
<ul>
<li><strong>Useful outside of rust</strong> - There are numerous languages with numerous ABI specifications.  In some cases, those ABI specifications have been adopted by other languages, even when the ABI is not the best fit for the other languages.</li>
</ul>
<h2><a class="header" href="#whats-the-difference-between-an-abi-and-an-apiffi" id="whats-the-difference-between-an-abi-and-an-apiffi">What's the difference between an ABI and an API/FFI?</a></h2>
<p>We can go on all day talking about how <em>nice</em> and ABI would be, but after you say (or rather write) the word a couple hundred times, it loses it's meaning and rather encapsulates a set of rather lofty ideals.</p>
<p>This shouldn't be the case.</p>
<p>An ABI is something quite simple on the surface level: the memory layout and calling conventions of an executable. It can also be used in a broader sense, but it's best to be specific.</p>
<p>The FFI is the user-code interface the language provides to interact with other executables, which may have a different ABI. The FFI forms the transition layer between different ABIs. Currently, in Rust the FFI is most likened unto <code>extern &quot;C&quot;</code> and <code>repr(C)</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../intro/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../intro/history.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../intro/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../intro/history.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
